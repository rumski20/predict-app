<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<title>Predict</title>
	<!--[if lt IE 9]><script src="js/html5shiv-printshiv.js" media="all"></script><![endif]-->

    <style type="text/css">
    .tg  {border-collapse:collapse;border-spacing:0;border-color:#aaa;}
    .tg td{font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:0px;overflow:hidden;word-break:normal;border-color:#aaa;color:#333;background-color:#fff;border-top-width:1px;border-bottom-width:1px;text-align: center;}
    .tg th{font-family:Arial, sans-serif;font-size:14px;font-weight:normal;padding:10px 12px;border-style:solid;border-width:0px;overflow:hidden;word-break:normal;border-color:#aaa;color:#fff;background-color:#f38630;border-top-width:1px;border-bottom-width:1px;}
    .tg .tg-header{background-color:#6200c9}
    .tg .tg-data{background-color:#cbcefb}
    </style>

</head>
<body>

    <h3> Batting </h3>
    <textarea id="batBin" class="pasteValues" cols="100" rows="10"></textarea>

    <div id="bat">
        <table id="batTable" class="tg">
          <tr>
            <th class="tg-header">Name</th>
            <th class="tg-header">Dur</th>
            <th class="tg-header">Health</th>
            <!-- <th class="tg-header">AB</th> -->
            <th class="tg-header">AVG</th>
            <th class="tg-header">OBP</th>
            <th class="tg-header">SLG</th>
            <!-- <th class="tg-header">Rc27</th> -->
          </tr>
        </table>
    </div>

    <h3> Pitching </h3>
    <textarea id="pitBin" class="pasteValues" cols="100" rows="10"></textarea>

    <div id="pit">
        <table id="pitTable" class="tg">
          <tr>
            <th class="tg-header">Name</th>
            <th class="tg-header">Dur</th>
            <th class="tg-header">Health</th>
            <th class="tg-header">Stamina</th>
            <th class="tg-header">OPS</th>
            <th class="tg-header">WHIP</th>
            <th class="tg-header">FIP</th>
            <!-- <th class="tg-header">Rc27</th> -->
          </tr>
        </table>
    </div>

    <script type="text/javascript">
        var bins = document.getElementsByClassName("pasteValues");
        for (var i = 0; i < bins.length; ++i) {
          bins[i].onchange = handleValues;
        }

        function handleValues(event) {
            console.log(this.value);
            var tempArray = this.value.split('\n'),
            valArray = [];
            console.log(tempArray);
            tempArray.forEach(
                function(val, ind) {
                    if (val.length > 1) {
                        valArray.push(val.split('\t'));
                    }
                }
            );
            console.log(valArray);
            // check for which one
            if (this.id == 'batBin') {
                clearTable('bat');
                populateTable(valArray, 'bat');
            } else {
                clearTable('pit');
                populateTable(valArray, 'pit');
            }
        }

        function populateTable(data, type) {
            // data is an array of arrays
            // Find a <table> element with id="myTable":
            var table = document.getElementById(type + "Table");
            // loop through formatted data
            data.forEach(
                function(player, ind) {  // player is an array of values
                    var row = table.insertRow(-1); // insert row
                    row.insertCell(0).innerHTML = player[0];
                    row.insertCell(1).innerHTML = player[4];
                    row.insertCell(2).innerHTML = player[5];
                    if (type == 'bat') {
                        row.insertCell(3).innerHTML = roundy(predict(player, 'AVG'), 3);
                        row.insertCell(4).innerHTML = roundy(predict(player, 'OBP'), 3);
                        row.insertCell(5).innerHTML = roundy(predict(player, 'SLG'), 3);
                        // row.insertCell(7).innerHTML = roundy(predict(player, 'Rc27'), 2);
                    } else {  // pitching
                        row.insertCell(3).innerHTML = player[6];
                        row.insertCell(4).innerHTML = roundy(predict(player, 'OPS'), 3);
                        row.insertCell(5).innerHTML = roundy(predict(player, 'WHIP'), 2);
                        row.insertCell(6).innerHTML = roundy(predict(player, 'FIP'), 2);
                    }
                }
            )
        }

        function predict(playerData, stat) {
            console.log(playerData, stat);
            var predValue = data[stat].Intercept;
            for (var rating in data[stat]) {
                switch (rating) {
                    case 'CN':
                        predValue += data[stat].CN * parseInt(playerData[6]);
                        break;
                    case 'PW':
                        predValue += data[stat].PW * parseInt(playerData[7]);
                        break;
                    case 'LH':
                        predValue += data[stat].LH * parseInt(playerData[8]);
                        break;
                    case 'RH':
                        predValue += data[stat].RH * parseInt(playerData[9]);
                        break;
                    case 'BE':
                        predValue += data[stat].BE * parseInt(playerData[10]);
                        break;
                    case 'SP':
                        predValue += data[stat].SP * parseInt(playerData[11]);
                        break;
                    case 'CT':
                        predValue += data[stat].CT * parseInt(playerData[7]);
                        break;
                    case 'LH.1':
                        predValue += data[stat]['LH.1'] * parseInt(playerData[8]);
                        break;
                    case 'RH.1':
                        predValue += data[stat]['RH.1'] * parseInt(playerData[9]);
                        break;
                    case 'VE':
                        predValue += data[stat].VE * parseInt(playerData[10]);
                        break;
                    case 'GB':
                        predValue += data[stat].GB * parseInt(playerData[11]);
                        break;
                    case 'P1':
                        predValue += data[stat].P1 * parseInt(playerData[12]);
                        break;
                    case 'P2':
                        predValue += data[stat].P2 * parseInt(playerData[13]);
                        break;
                    case 'P3':
                        predValue += data[stat].P3 * parseInt(playerData[14]);
                        break;
                    case 'P5':
                        predValue += data[stat].P5 * parseInt(playerData[16]);
                        break;
                }
                console.log(rating, predValue);
            }
            console.log(predValue);
            return predValue;
        }

        function roundy(value, decimals) {
            return Number(Math.round(value+'e'+decimals)+'e-'+decimals);
        }

        function clearTable(type) {
            var table = document.getElementById(type + "Table");
            for (var i = table.rows.length - 1; i > 0; i--) {
                table.deleteRow(i);
            }
        }

// Name (bats) Age Pos %   Durability  Health  Contact Power   Batting Versus Left-Handed Pitching Batting Versus Right-Handed Pitching    Batting Eye Speed   Range   Glove   Arm Strength    Arm Accuracy    Pitch Calling   $
// Rule 5 Draftee Jeffrey Beckett (S)  26  1B  100 77  44  29  88  41  57  79  46  39  28  30  36  1   $327K
// Ernest Coffey (L)   25  LF  100 70  47  80  45  69  57  57  23  43  33  41  40  18  $55K

        var data = {
            AB : {
                Intercept  :27.1665018,
                CN          : 0.8936592,
                PW          : 0.9863651,
                LH          : 1.4264479,
                RH          : 1.1459426,
                BE          : 0.8424884,
                DU          : 1.1555163,
                HE          : 0.9948427
            },
            AVG : {  // Rsq: 0.2865625
                Intercept   :0.1728766596,
                CN          :0.0003839499,
                LH          :0.0003243733,
                RH          :0.0004827432,
                BE          :0.0003075926
            },
            OBP : {  // Rsq: 0.4673254
                Intercept   :0.1956397915,
                CN          :0.0005087604,
                LH          :0.0002599466,
                RH          :0.0003976977,
                BE          :0.0009669389
            },
            SLG : {  // Rsq: 0.6130545
                Intercept   :0.0974892089,
                CN          :0.0006297989,
                PW          :0.0026319232,
                LH          :0.0004079642,
                RH          :0.0007703233,
                BE          :0.0005397229,
                SP          :0.0003424358
            },
            Rc27 : {
                Intercept :21.89611467,
                CN          : 0.12340745,
                PW          : 0.09589677,
                LH          : 0.10247291,
                RH          : 0.05994001,
                BE          : 0.11927317,
                DU          : 0.11651043,
                HE          : 0.15890700
            },
            WHIP : {  // Adj. Rsq: 0.2841573
                Intercept   : 2.5978237473,
                CT          :-0.0047886338,
                'LH.1'        :-0.0021603048,
                'RH.1'        :-0.0068806281,
                VE          : 0.0003737825,
                P1          :-0.0016857023,
                P2          :-0.0011738003
            },
            OPS : {  // Adj. Rsq: 0.313896
                Intercept   : 1.2937001155,
                ST          : 0.0002060046,
                CT          :-0.0010762807,
                'LH.1'        :-0.0011325101,
                'RH.1'        :-0.0034113419,
                GB          :-0.0002711084,
                P1          :-0.0011536711,
                P2          :-0.0006881799
            },
            FIP : {  // Adj. Rsq: 0.300334
                Intercept   : 9.619598945,
                CT          :-0.017957664,
                'LH.1'        :-0.006937385,
                'RH.1'        :-0.025560365,
                VE          :-0.003169440,
                GB          :-0.003670697,
                P1          :-0.008737261,
                P2          :-0.005429195,
                P5          : 0.001920657
            }
        }

    </script>

</body>
</html>
